# 実装ロードマップ

## Phase 1: 基盤構築 (Tasks 1-6)

### Task 1: Monorepo セットアップ

- **目標**: pnpm workspace による monorepo 構造構築
- **成果物**:
  - pnpm-workspace.yaml
  - 各パッケージの package.json
  - TypeScript/ESLint/Prettier 設定

### Task 2: データベース・ORM セットアップ

- **目標**: PostgreSQL + Prisma ORM によるデータ基盤
- **成果物**:
  - prisma/schema.prisma
  - マイグレーションファイル
  - データベース接続ユーティリティ

### Task 3: Finnhub API 連携サービス

- **目標**: 外部 API との安全で効率的な連携
- **成果物**:
  - apps/server/src/services/finnhubService.ts
  - API レート制限・エラーハンドリング
  - 単体テスト

### Task 4: バックエンド API 構築

- **目標**: RESTful API エンドポイント群
- **成果物**:
  - Express ルーター設定
  - API エンドポイント (search, quote, candles)
  - リクエスト検証ミドルウェア

### Task 5: Repository パターン実装

- **目標**: データアクセス層の抽象化
- **成果物**:
  - BaseRepository インターフェース
  - 各エンティティ用 Repository 実装
  - CRUD + クエリメソッド

### Task 6: データキャッシュ・ストレージ層

- **目標**: パフォーマンス最適化のためのキャッシュ戦略
- **成果物**:
  - キャッシュ無効化戦略
  - 重複データ排除ロジック
  - トランザクションサポート

## Phase 2: フロントエンド基盤 (Tasks 7-9)

### Task 7: React アプリケーション基盤

- **目標**: スケーラブルなフロントエンド基盤
- **成果物**:
  - Vite + React + TypeScript セットアップ
  - React Router 設定
  - Context API による状態管理
  - Error Boundary コンポーネント

### Task 8: チャートコンポーネント (Core)

- **目標**: TradingView Lightweight Charts 統合
- **成果物**:
  - Chart wrapper コンポーネント
  - Candlestick レンダリング
  - インタラクション (zoom, pan, crosshair)
  - ツールチップ機能

### Task 9: シンボル検索・選択 UI

- **目標**: 直感的な金融商品検索機能
- **成果物**:
  - デバウンス付き検索入力
  - 検索結果ドロップダウン
  - ローディング・エラー状態処理

## Phase 3: 機能拡張 (Tasks 10-12)

### Task 10: 時間軸コントロール

- **目標**: 複数時間軸でのデータ表示
- **成果物**:
  - 時間軸セレクター
  - データ取得・キャッシュロジック
  - スムーズな遷移アニメーション

### Task 11: カスタマイズ・テーマ機能

- **目標**: ユーザー個別設定による UX 向上
- **成果物**:
  - チャートタイプセレクター
  - ダーク/ライトテーマ
  - 設定永続化機能

### Task 12: リアルタイムデータ更新

- **目標**: WebSocket による即座データ反映
- **成果物**:
  - WebSocket サーバー・クライアント
  - リアルタイムストリーミング
  - 接続エラー処理・再接続

## Phase 4: 高度機能 (Tasks 13-15)

### Task 13: テクニカル指標

- **目標**: プロレベルの技術分析ツール
- **成果物**:
  - 基本指標 (SMA, EMA, RSI, MACD)
  - オーバーレイ・オシレーター表示
  - 指標設定インターフェース

### Task 14: パフォーマンス最適化

- **目標**: 大量データ処理の高速化
- **成果物**:
  - データ仮想化
  - 遅延読み込み・ページング
  - メモリ管理最適化

### Task 15: エラーハンドリング・UX向上

- **目標**: 堅牢性とユーザビリティの両立
- **成果物**:
  - グローバルエラーハンドリング
  - ユーザーフレンドリーなエラーメッセージ
  - リトライ機構

## Phase 5: モバイル・品質 (Tasks 16-17)

### Task 16: レスポンシブデザイン

- **目標**: モバイルデバイス対応
- **成果物**:
  - TailwindCSS レスポンシブレイアウト
  - タッチインタラクション最適化
  - スワイプジェスチャー

### Task 17: テストスイート

- **目標**: 包括的品質保証
- **成果物**:
  - Jest + React Testing Library
  - Supertest API テスト
  - Playwright E2E テスト
  - 視覚回帰テスト

### Task 18: 本番デプロイメント

- **目標**: プロダクション対応インフラ
- **成果物**:
  - Docker コンテナ化
  - ヘルスチェックエンドポイント
  - 監視・ログ基盤
  - デプロイメントスクリプト

## 重要なマイルストーン

### Milestone 1: MVP (Tasks 1-9 完了)

- 基本的なチャート表示・シンボル検索が動作
- フロントエンド・バックエンドの基盤完成

### Milestone 2: 機能完備 (Tasks 1-15 完了)

- 全主要機能の実装完了
- パフォーマンス最適化済み

### Milestone 3: プロダクションレディ (Tasks 1-18 完了)

- 本番環境デプロイ可能
- 包括的テストカバレッジ達成

## 並行作業の可能性

### Phase 1 内での並行作業

- Task 2 (DB) と Task 3 (API) は並行実装可能
- Task 4 (API ルート) と Task 5 (Repository) は段階的実装

### Phase 2 での並行作業

- Task 7 (React基盤) 完了後、Task 8, 9 は並行開発可能

### 継続的作業

- **テスト作成**: 各 Task 完了時に継続的実装
- **ドキュメント更新**: 仕様変更時に随時更新
- **型定義**: packages/shared は全フェーズで継続更新

## リスク・依存関係

### 高リスク要素

- **Finnhub API 制限**: レート制限・利用料金
- **TradingView Lightweight Charts**: ライセンス・バージョン互換性
- **リアルタイム処理**: WebSocket 安定性・スケーラビリティ

### クリティカルパス

1. Task 1 → 2 → 3 → 4 (バックエンド基盤)
2. Task 7 → 8 (フロントエンド基盤)
3. Task 12 (リアルタイム) はインフラ依存度高

## 品質基準

### 各 Phase 完了基準

- **全テスト通過**: 単体・統合・E2E
- **型安全性**: TypeScript エラーゼロ
- **コード品質**: ESLint/Prettier 準拠
- **パフォーマンス**: 応答時間要件満足

### レビューポイント

- **セキュリティ**: 脆弱性スキャン合格
- **アクセシビリティ**: WCAG 2.1 準拠
- **ブラウザ互換性**: 主要ブラウザ動作確認
